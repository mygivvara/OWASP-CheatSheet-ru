# Шпаргалка по безопасности мобильных приложений

Разработка мобильных приложений сопряжена с определенными проблемами безопасности, которые являются
уникальными по сравнению с веб-приложениями и другими видами программного обеспечения. 
В этой шпаргалке приведены рекомендации по обеспечению безопасности при разработке мобильных приложений.
Это ни в коем случае не исчерпывающее руководство, а скорее отправная точка для
разработчиков, с которой они должны задуматься о безопасности при разработке своих мобильных приложений.

## Архитектура и дизайн

### 1. Безопасность по замыслу

- Выбирайте безопасный дизайн в начале разработки, а не в конце.

- Помните о таких принципах безопасности, как минимизация привилегий, всесторонняя защита и разделение проблем.
- Следуйте отраслевым стандартам и передовой практике, таким как:
    - Национальный институт стандартов и технологий (NIST)
    - Рабочая группа по разработке Интернета (IETF)

Дополнительную информацию смотрите в
[Шпаргалке по безопасному дизайну продукта](Secure_Product_Design_Cheat_Sheet.md).

### 2. Защищенные API-интерфейсы

- Убедитесь, что ваше мобильное приложение безопасно взаимодействует с серверными службами.
- Используйте OAuth2, JWT или аналогичные для безопасной аутентификации.
- Регулярно обновляйте и заменяйте все используемые ключи API или токены.

### 3. Принцип наименьших привилегий

- Запрашивайте только те разрешения, которые необходимы вашему приложению.
- Это относится не только к разрешениям устройства, предоставляемым пользователем, но и к разрешениям, предоставляемым приложению внутренними службами.
- Избегайте хранения файлов приложения с чрезмерно широкими разрешениями.
- Безопасность по умолчанию: по умолчанию приложения должны иметь максимально безопасные настройки.

### 4. Цепочка поставок

Разработка с использованием сторонних библиотек и компонентов может привести к
нарушениям безопасности.

- Убедитесь, что приложение подписано.
- Используйте только надежные и проверенные сторонние библиотеки и компоненты.
- Установите контроль безопасности для обновлений, исправлений и релизов приложений.
- Мониторинг и выявление инцидентов безопасности, связанных с использованием продуктов сторонних производителей.

Смотрите [Шпаргалку по управлению уязвимыми зависимостями](Vulnerable_Dependency_Management_Cheat_Sheet.md) для получения рекомендаций по управлению зависимостями сторонних разработчиков при обнаружении уязвимостей.

## Аутентификация и авторизация

Аутентификация - сложная тема, и в ней много подводных камней. Логика аутентификации должна быть написана и протестирована с особой тщательностью. Приведенные здесь советы являются лишь отправной точкой и едва ли касаются поверхности. Для получения дополнительной информации ознакомьтесь с [Шпаргалкой по проверке подлинности](Authentication_Cheat_Sheet.md) и [M1: Небезопасная аутентификация/авторизация](https://owasp.org/www-project-mobile-top-10/2023-risks/1-insecure-authentication-authorization.html) из списка OWASP Mobile Top 10.

### 1. Не доверяете клиенту

- Выполняйте аутентификацию/авторизацию на стороне сервера и загружайте данные на устройство только после успешной аутентификации.
- Если данные хранятся локально, зашифруйте их, используя ключ, полученный из учетных данных пользователя для входа в систему.
- Не храните пароли пользователей на устройстве; используйте токены, относящиеся к конкретному устройству, которые могут быть отозваны.
- Избегайте использования поддельных значений, таких как идентификаторы устройств, для аутентификации.
- Предполагайте, что все элементы управления на стороне клиента можно обойти, и выполняйте их также на стороне сервера.
- Включите код на стороне клиента для обнаружения подделки кода / двоичных файлов.

### 2. Обработка учетных данных

- Не вводите жестко учетные данные в мобильном приложении.
- Шифруйте учетные данные при передаче.
- Не храните учетные данные пользователя на устройстве. Рассмотрите возможность использования защищенных токенов доступа с возможностью отзыва.

### 3. Политика в отношении паролей и PIN-кодов

- Пароль должен быть сложным.
- Не допускайте коротких PIN-кодов, например, из 4 цифр.
- Используйте специальные механизмы безопасного хранения, такие как Keychain (iOS) или Keystore (Android).

### 4. Биометрическая аутентификация

- Используйте поддерживаемые платформой методы биометрической аутентификации.
- Всегда предоставляйте запасной вариант, например PIN-код.

### 5. Управление сеансами

- Сеансы должны отключаться по истечении времени ожидания после бездействия.
- Используйте функцию удаленного выхода из системы.
- Используйте случайно сгенерированные токены сеанса.
- Защищайте данные сеанса как на стороне клиента, так и на стороне сервера.

### 6. Хранение токенов

- Надежно храните токены аутентификации.
- Корректно обрабатывайте истечение срока действия токена.

### 7. Конфиденциальные операции

- Требовать от пользователей повторной аутентификации для таких важных операций, как смена паролей или обновление платежной информации.
- Рассмотрите возможность повторной аутентификации перед отображением конфиденциальной информации.
- Требуйте проверки авторизации для любых внутренних функций.

## Хранение данных и конфиденциальность

### 1. Шифрование данных

- Шифруйте конфиденциальные данные как при хранении, так и при передаче.
- Храните личные данные во внутренней памяти устройства.
- Используйте API-интерфейсы платформы для шифрования. Не пытайтесь внедрять собственные алгоритмы шифрования.

### 2. Утечка данных

- Остерегайтесь кэширования, ведения журнала и фоновых снимков. Убедитесь, что конфиденциальные данные не просочились через эти механизмы.

Смотрите [Руководство по ведению журнала](Logging_Cheat_Sheet.md#data-to-exclude) для получения примеров данных, которые не следует регистрировать.

### 3. Используйте HTTPS

- Всегда используйте HTTPS для сетевого взаимодействия.

### 4. Сторонние библиотеки

- Убедитесь, что все сторонние библиотеки безопасны и находятся в актуальном состоянии.

### 5. Информация, позволяющая установить личность (PII)

- Сведите к минимуму любые PII по мере необходимости.
- По возможности замените PII менее важной информацией.
- Сократите PII, например, реже обновляйте местоположение.
- Реализуйте автоматическое истечение срока действия и удаление личных данных, чтобы свести к минимуму их хранение.
- Запрашивайте согласие пользователя перед сбором или использованием личных данных.

## Сетевая связь

### 1. Не доверяйте сети

- Предположим, что все сетевые коммуникации небезопасны и могут быть перехвачены.

### 2. Используйте защищенные протоколы

- Используйте HTTPS для всех видов сетевого взаимодействия.
- Не переопределяйте проверку SSL-сертификата, чтобы разрешить использование самозаверяющего или недействительного сертификата.
- Избегайте Sslsession смешанной версии.
- Шифруйте данные, даже если они отправляются по протоколу SSL, на случай будущих уязвимостей SSL.
- Используйте надежные наборы шифров, соответствующие отраслевым стандартам, с ключом соответствующей длины.
- Используйте сертификат, подписанный надежным поставщиком центров сертификации
- Избегайте отправки конфиденциальных данных по SMS.

### 3. Закрепление сертификата

- Рассмотрите возможность закрепления сертификата. Смотрите [Шпаргалку по закреплению](Pinning_Cheat_Sheet.md), чтобы узнать о плюсах и минусах этого подхода.

## Пользовательский интерфейс

### 1. Маскировка данных пользовательского интерфейса

- Маскируйте конфиденциальную информацию в полях пользовательского интерфейса, чтобы предотвратить переход через плечо.

### 2. Уведомления пользователя

- Информируйье пользователя о действиях, связанных с безопасностью, таких как вход в систему с новых устройств.

### 3. Проверка вводимых данных

- Проверяйте и упорядочивайте пользовательский ввод. Дополнительную информацию смотрите в [Шпаргалке по проверке вводимых данных](Input_Validation_Cheat_Sheet.md).

### 4. Проверка выходных данных

- Проверяйте и очищайте выходные данные для предотвращения атак на внедрение и выполнение.

## Качество кода

### 1. Статический анализ

- Используйте инструменты статического анализа для выявления уязвимостей.

### 2. Анализ кода

- Уделяйте основное внимание безопасности во время анализа кода.

### 3. Обновляйте библиотеки

- Обновляйте все свои библиотеки, чтобы исправлять известные уязвимости.

## Целостность приложения

- Отключите отладку.
- Включите код для проверки целостности кода приложения.
- Обфусцируйте двоичный файл приложения.

## Тестирование

### 1. Тестирование на проникновение

- Выполняйье этичный взлома для выявления уязвимостей.
- Примеры тестов:
    - Оценивайте криптографические уязвимости.
    - Попытайтесь анонимно выполнить функции внутреннего сервера путем удаления сеансовых маркеров из POST/GET-запросов.

### 2. Автоматизированные тесты

- Используйте автоматизированные тесты, чтобы убедиться, что функции безопасности работают должным образом и что средства контроля доступа применяются надлежащим образом.

### 3. Тестирование юзабилити

- Убедитесь, что функции безопасности не вредят юзабилити, что может привести к обходу пользователями функций безопасности.

## После развертывания

### 1. Реагирование на инциденты

- Разработайте четкий план реагирования на инциденты.

### 2. Обновления

- Планируйте регулярные обновления и исправления. В случае мобильных приложений это особенно важно из-за задержки между выпуском исправления и фактическим получением пользователями обновленной версии из-за процессов проверки в App Store и времени, необходимого пользователям для обновления своих приложений.
- Используйте механизм, позволяющий заставить пользователей обновлять версию своего приложения при необходимости.

### 3. Мониторинг и аналитика

- Используйте мониторинг в режиме реального времени для обнаружения угроз и реагирования на них.

## Рекомендации для конкретной платформы

### Android

- Используйте Android ProGuard для обфускации кода.
- Избегайте хранения конфиденциальных данных в SharedPreferences. Более подробную информацию смотрите в [Android docs](https://developer.android.com/topic/security/data) о безопасной работе с данными.
- Отключите режим резервного копирования, чтобы предотвратить сохранение конфиденциальных данных в резервных копиях.

### iOS

- Используйте ATS (App Transport Security) для обеспечения строгих политик безопасности при
сетевом взаимодействии.
- Не храните конфиденциальные данные в файлах plist.

Для получения дополнительной информации посетите [проект OWASP Mobile Top 10 Project](https://owasp.org/www-project-mobile-top-10/).
Более подробную информацию о системе мобильной безопасности смотрите в [Проекте OWASP Mobile Application Security Project](https://mas.owasp.org/).
