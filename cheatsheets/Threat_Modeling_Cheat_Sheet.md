# Шпаргалка по моделированию угроз

## Вступление

Моделирование угроз - важная концепция, которую должны понимать современные разработчики приложений. Цель этой шпаргалки - предоставить краткое, но действенное руководство как для новичков в моделировании угроз, так и для тех, кто хочет повысить свою квалификацию. Официальная страница проекта находится по адресу [https://owasp.org/www-project-threat-model/](https://owasp.org/www-project-threat-model/).

## Обзор

В контексте безопасности приложений моделирование угроз - это структурированный, повторяемый процесс, используемый для получения полезной информации о характеристиках безопасности конкретной системы. Он включает в себя моделирование системы с точки зрения безопасности, идентификацию применимых угроз на основе этой модели и определение мер реагирования на эти угрозы. Моделирование угроз анализирует систему с точки зрения соперничества, уделяя особое внимание способам, с помощью которых злоумышленник может воспользоваться системой.

Моделирование угроз в идеале выполняется на ранней стадии SDLC, например, на этапе проектирования. Более того, это не то, что выполняется один раз и никогда больше не повторяется. Модель угроз - это то, что следует поддерживать, обновлять и совершенствовать вместе с системой. В идеале моделирование угроз должно быть легко интегрировано в обычный процесс SDLC команды; его следует рассматривать как стандартный и необходимый этап процесса, а не как дополнение.

Согласно [Манифесту о моделировании угроз] (https://www.threat modeling manifesto.или/), процесс моделирования угроз должен отвечать на следующие четыре вопроса:

1. Над чем мы работаем?
2. Что может пойти не так?
3. Что мы собираемся с этим делать?
4. Достаточно ли хорошо мы поработали?

Эти четыре вопроса лягут в основу четырех основных этапов, описанных ниже.

## Преимущества

Прежде чем перейти к обзору процесса, возможно, стоит ответить на вопрос: зачем нужна модель угроз? Зачем усложнять процесс разработки? Каковы преимущества? В следующем разделе будут кратко изложены ответы на некоторые из этих вопросов.

### Выявляйте риски на ранней стадии

Моделирование угроз направлено на выявление потенциальных проблем безопасности на этапе проектирования. Это позволяет сделать систему безопасности "встроенной", а не "привинченной". Это гораздо эффективнее, чем выявлять и устранять недостатки безопасности после запуска системы в эксплуатацию.

### Повышайте осведомленность о безопасности

Правильное моделирование угроз требует от участников творческого и критического подхода к анализу ситуации с безопасностью и угрозами конкретного приложения. Это заставляет участников "мыслить как злоумышленник" и применять общие знания в области безопасности в конкретном контексте. Моделирование угроз - это, как правило, командная работа, в ходе которой участников поощряют делиться идеями и предоставлять отзывы о других. В целом, моделирование угроз может оказаться весьма познавательным мероприятием, приносящим пользу участникам.

### Улучшеайте видимость объекта оценки (ОО)

Моделирование угроз требует глубокого понимания оцениваемой системы. Чтобы правильно смоделировать угрозы, необходимо понимать потоки данных, границы доверия и другие характеристики системы. Таким образом, [Stiliyan Simeonova](https://securityintelligence.com/threat-modeling-in-the-enterprise-part-1-understanding-the-basics/) утверждает, что улучшение видимости системы и ее взаимодействий является одним из преимуществ моделирования угроз.

## Решайте каждый вопрос

Не существует общепринятого отраслевого стандарта для процесса моделирования угроз, нет "правильного" решения для каждого варианта использования. Однако, несмотря на это разнообразие, большинство подходов в той или иной форме включают процессы системного моделирования, идентификации угроз и реагирования на риски. Основываясь на этих общих чертах и руководствуясь четырьмя ключевыми вопросами моделирования угроз, рассмотренными выше, в этой инструкции моделирование угроз разбито на четыре основных этапа: декомпозиция приложения, идентификация и ранжирование угроз, меры по смягчению последствий, а также проверка и валидация. Есть процессы, которые в меньшей степени соответствуют этому, в том числе PASTA и OCTAVE, у каждого из которых есть страстные сторонники.

### Системное моделирование

Этап моделирования системы направлен на то, чтобы ответить на вопрос "что мы создаем"? Без понимания системы невозможно по-настоящему понять, какие угрозы наиболее применимы к ней; таким образом, этот этап обеспечивает важную основу для последующих действий. Хотя на этом первом этапе моделирования угроз могут использоваться различные методы, диаграммы потоков данных (DFD), пожалуй, являются наиболее распространенным подходом.

DFD позволяют визуально моделировать систему и ее взаимодействие с данными и другими объектами; они создаются с использованием [небольшого количества простых символов](https://github.com/adamshostack/DFD3). DFD могут быть созданы с помощью специальных инструментов моделирования угроз, таких как [Threat Dragon от OWASP](https://github.com/OWASP/threat-dragon) или [Инструмент моделирования угроз от Microsoft] (https://learn.microsoft.com/en-us/azure/security/develop/threat-modeling-tool), или с использованием решений для построения диаграмм общего назначения, таких как [draw.io](https://draw.io). Если вы предпочитаете подход "в виде кода", в этом вам может помочь [OWASP's pytm](https://owasp.org/www-project-pytm/). В зависимости от масштаба и сложности моделируемой системы может потребоваться несколько DFD. Например, можно было бы создать DFD, представляющий собой высокоуровневый обзор всей системы, а также ряд более сфокусированных DFD, которые детализируют подсистемы. Технические средства не являются строго необходимыми; в некоторых случаях может быть достаточно использования белой доски, хотя предпочтительнее иметь DFD в форме, которую можно легко сохранять, на которую можно ссылаться и обновлять по мере необходимости.

Независимо от того, как создается DFD или аналогичная модель, важно, чтобы решение обеспечивало четкое представление о границах доверия, потоках данных, хранилищах данных, процессах и внешних объектах, которые могут взаимодействовать с системой. Они часто представляют собой возможные точки атаки и являются важной информацией для последующих шагов.

Другим подходом к диаграммам потоков данных (DFD) может быть метод мозгового штурма, который является эффективным методом генерации идей и определения предметной области проекта. Применение мозгового штурма в этом контексте может принести множество преимуществ, таких как повышение вовлеченности команды, унификация знаний и терминологии, общее понимание предметной области и быстрое определение ключевых процессов и зависимостей. Одним из главных аргументов в пользу использования мозгового штурма является его гибкость и адаптивность практически к любому сценарию, включая бизнес-логику. Кроме того, этот метод особенно полезен, когда в занятии принимают участие менее подготовленные специалисты, поскольку он устраняет барьеры, связанные с пониманием и применением компонентов моделей DFD и их корректностью.

Мозговой штурм вовлекает всех участников, способствуя лучшему общению и взаимопониманию в решении проблем. У каждого члена команды есть возможность внести свой вклад, что повышает чувство ответственности и вовлеченности. Во время мозгового штурма участники могут совместно определить и согласовать ключевые термины и концепции, что приведет к созданию единого языка, используемого в проекте. Это особенно важно в сложных проектах, где у разных команд могут быть разные подходы к терминологии. Благодаря динамичному характеру мозгового штурма команда может быстро определить ключевые бизнес-процессы и их взаимосвязи.

Интеграция результатов мозгового штурма с формальными методами моделирования может привести к лучшему пониманию предметной области и более эффективному проектированию системы.

### Идентификация угроз

После того, как система была смоделирована, пришло время ответить на вопрос "что может пойти не так?". Этот вопрос должен быть рассмотрен с учетом результатов первого этапа; то есть, он должен быть сосредоточен на выявлении и ранжировании угроз в контексте конкретной оцениваемой системы. Чтобы ответить на этот вопрос, разработчики моделей угроз имеют в своем распоряжении множество источников данных и методов. В качестве иллюстрации в этой таблице-инструкции используется STRIDE; однако на практике наряду со STRIDE или вместо него могут использоваться и другие подходы.

STRIDE - это развитая и популярная технология моделирования угроз и мнемоническая система, первоначально разработанная сотрудниками Microsoft. Чтобы облегчить идентификацию угроз, STRIDE группирует угрозы в одно из шести общих приглашений, и инженерам рекомендуется систематически рассматривать, как эти общие угрозы могут проявляться в контексте конкретной оцениваемой системы. Каждая угроза STRIDE может рассматриваться как нарушение желаемого атрибута безопасности; ниже приведены категории и связанные с ними желательные атрибуты:

| Threat Category             | Violates          | Examples                                                                                                    |
| --------------------------- | ----------------- | ----------------------------------------------------------------------------------------------------------- |
| **S**poofing                | Подлинность        | Злоумышленник крадет токен аутентификации легитимного пользователя и использует его для выдачи себя за этого пользователя.       |
| **T**ampering               | Целостность        | Злоумышленник злоупотребляет приложением для выполнения непреднамеренных обновлений базы данных.                            |
| **R**epudiation             | Неотрицаемость     | Злоумышленник манипулирует журналами, чтобы скрыть свои действия.                                                        |
| **I**nformation Disclosure  | Конфиденциальность | Злоумышленник извлекает данные из базы данных, содержащей информацию об учетной записи пользователя.                                      |
| **D**enial of Service       | Доступность        | Злоумышленник блокирует доступ легитимного пользователя к своей учетной записи, выполняя множество неудачных попыток аутентификации. |
| **E**levation of Privileges | Авторизация        | Злоумышленник вмешивается в JWT, чтобы изменить свою роль.                                                        |

STRIDE предоставляет ценную структуру для ответа на вопрос "что может пойти не так". Кроме того, это очень гибкий подход, и начало работы не обязательно должно быть сложным. На начальном этапе можно использовать простые методы, такие как мозговой штурм, работа с белой доской или даже [игры](https://github.com/adamshostack/eop/). STRIDE также включен в популярные инструменты моделирования угроз, такие как [Threat Dragon от OWASP] (https://github.com/OWASP/threat-dragon) и [Инструмент моделирования угроз от Microsoft] (https://learn.microsoft.com/en-us/azure/security/develop/threat-modeling-tool). Кроме того, как процесс относительно высокого уровня, STRIDE хорошо сочетается с более тактическими подходами, такими как цепочки убийств или [ATT&CK от MITRE] (https://attack.mitre.org/) (пожалуйста, обратитесь к [этому заголовку](https://blog.isc2.org/isc2_blog/2020/02/under-attack-how-mitres-methodology-to-find-threats-and-embed-counter-measures-might-work-in-your-or.html), чтобы узнать, как STRIDE и ATT& CK могут работать вместе).

После выявления возможных угроз пользователи часто ранжируют их. Теоретически, ранжирование должно основываться на математическом соотношении вероятности выявленных угроз и их воздействия. Угроза, которая может возникнуть и привести к серьезному ущербу, будет иметь гораздо более высокий приоритет, чем угроза, которая маловероятна и окажет лишь умеренное воздействие. Однако и то, и другое может оказаться сложным для расчета, и они игнорируют работу по устранению проблемы. Некоторые выступают за включение этого вопроса в единую систему определения приоритетов.

### Ответные меры и меры по смягчению последствий

Имея представление как о системе, так и о применимых угрозах, теперь пришло время ответить на вопрос "что мы собираемся с этим делать"?. На каждую выявленную ранее угрозу должны быть приняты ответные меры. Меры реагирования на угрозы похожи на меры реагирования на риски, но не идентичны им. [Адам Шостак](https://shostack.org/resources/threat-modeling) перечислены следующие ответы:

- **Смягчение:** Принятие мер для снижения вероятности реализации угрозы.
- **Устранение:** Простое удаление функции или компонента, вызывающего угрозу.
- **Передача:** Передача ответственности другому субъекту, например заказчику.
- **Принятие:** Не снижайте, не устраняйте и не переносите риск, поскольку ни один из вышеперечисленных вариантов не является приемлемым с учетом бизнес-требований или ограничений.

Если кто-то решает устранить угрозу, то стратегии устранения должны быть сформулированы и задокументированы в виде требований. В зависимости от сложности системы, характера выявленных угроз и процесса, используемого для выявления угроз (STRIDE или другой метод), меры по устранению могут применяться как на уровне категории, так и на уровне отдельных угроз. В первом случае меры по смягчению последствий будут применяться ко всем угрозам, входящим в эту категорию. Стратегии по смягчению последствий должны быть не гипотетическими, а реально осуществимыми; они должны быть встроены в разрабатываемую систему. Хотя стратегии смягчения последствий должны быть адаптированы к конкретному приложению, такие ресурсы, как [Owasp ASVS](https://owasp.org/www-project-application-security-verification-standard/) и [список CWE MITRE](https://cwe.mitre.org/index.html), могут оказаться полезными при разработке этих мер реагирования.

### Проверка и валидация

Наконец, пришло время ответить на вопрос: "Достаточно ли хорошо мы поработали"? Модель угроз должна быть рассмотрена всеми заинтересованными сторонами, а не только командами разработчиков или безопасности. К числу областей, на которых следует сосредоточить внимание, относятся:

- Точно ли DFD (или аналогичный) отражает систему?
- Все ли угрозы были идентифицированы?
- Была ли согласована стратегия реагирования на каждую выявленную угрозу?
- Были ли разработаны стратегии снижения рисков до приемлемого уровня для выявленных угроз, устранение которых является желательной мерой реагирования?
- Была ли модель угроз официально задокументирована? Хранятся ли артефакты процесса моделирования угроз таким образом, чтобы к ним могли получить доступ те, кому "необходимо знать"?
- Можно ли протестировать согласованные меры по снижению рисков? Можно ли оценить успешность или неуспешность выполнения требований и рекомендаций, содержащихся в модели угроз?

## Моделирование угроз и команда разработчиков

### Проблемы

Моделирование угроз может быть сложной задачей для команд разработчиков по нескольким ключевым причинам. Во-первых, многим разработчикам не хватает достаточных знаний и опыта в области безопасности, что мешает им эффективно использовать методологии и фреймворки, выявлять и моделировать угрозы. Без надлежащей подготовки и понимания основных принципов безопасности разработчики могут упустить из виду потенциальные угрозы или неправильно оценить свои риски.

Кроме того, процесс моделирования угроз может быть сложным и отнимать много времени. Он требует системного подхода и углубленного анализа, что часто бывает трудно согласовать с жесткими графиками и необходимостью внедрения новых функциональных возможностей. Команды разработчиков могут испытывать нехватку инструментов и ресурсов для выполнения этой задачи, что приводит к разочарованию и унынию.

Еще одной проблемой является взаимодействие и коллаборация между различными подразделениями организации. Без эффективной коммуникации между группами разработчиков, служб безопасности и другими заинтересованными сторонами моделирование угроз может быть неполным или неправильно направленным.

### Решение проблем

Во многих случаях решение заключается в приглашении сотрудников служб безопасности на занятия по моделированию угроз, что может значительно улучшить процесс. Специалисты по безопасности обладают необходимыми знаниями о потенциальных угрозах, которые имеют решающее значение для эффективной идентификации, анализа рисков и снижения их последствий. Их опыт и понимание последних тенденций и методов, используемых киберпреступниками, могут стать ключом к обучению и развитию компетенций команд разработчиков. Такие совместные занятия не только расширяют знания разработчиков, но и формируют культуру сотрудничества и взаимной поддержки внутри организации, что приводит к более комплексному подходу к обеспечению безопасности.

Чтобы изменить текущую ситуацию, организациям следует инвестировать в регулярные тренинги по ИТ-безопасности для своих команд разработчиков. Эти тренинги должны проводиться экспертами и соответствовать конкретным потребностям команды. Кроме того, полезно внедрять процессы и инструменты, которые упрощают и автоматизируют моделирование угроз. Эти инструменты могут помочь в выявлении и оценке угроз, делая процесс более доступным и отнимающим меньше времени.

Также важно продвигать культуру безопасности во всей организации, где моделирование угроз рассматривается как неотъемлемая часть жизненного цикла разработки программного обеспечения (SDLC), а не как дополнительное бремя. Регулярные обзорные сессии и межкомандные семинары могут улучшить взаимодействие и коммуникацию, что приведет к более эффективному и всестороннему подходу к обеспечению безопасности. Благодаря этим действиям организации могут сделать моделирование угроз менее обременительным и более эффективным процессом, что принесет реальную пользу безопасности их систем.

## Ссылки на литературу

### Методы и техники

Список техник в алфавитмом порядке:

- [LINDDUN](https://linddun.org/)
- [PASTA](https://cdn2.hubspot.net/hubfs/4598121/Content%20PDFs/VerSprite-PASTA-Threat-Modeling-Process-for-Attack-Simulation-Threat-Analysis.pdf)
- [STRIDE](<https://learn.microsoft.com/en-us/previous-versions/commerce-server/ee823878(v=cs.20)?redirectedfrom=MSDN>)
- [OCTAVE](https://insights.sei.cmu.edu/library/introduction-to-the-octave-approach/)
- [VAST](https://go.threatmodeler.com/vast-methodology-data-sheet)

### Инструменты

- [Cairis](https://github.com/cairis-platform/cairis)
- [draw.io](https://draw.io) - see also [threat modeling libraries](https://github.com/michenriksen/drawio-threatmodeling) for the tool
- [IriusRisk](https://www.iriusrisk.com/) - offers a free Community Edition
- [Microsoft Threat Modeling Tool](https://learn.microsoft.com/en-us/azure/security/develop/threat-modeling-tool)
- [OWASP's Threat Dragon](https://github.com/OWASP/threat-dragon)
- [OWASP's pytm](https://owasp.org/www-project-pytm/)
- [TaaC-AI](https://github.com/yevh/TaaC-AI) - AI-driven Threat modeling-as-a-Code (TaaC)

### Общие ссылки на литературу

- [Awesome Threat Modeling](https://github.com/hysnsec/awesome-threat-modelling) - resource list
- [Tactical Threat Modeling](https://safecode.org/wp-content/uploads/2017/05/SAFECode_TM_Whitepaper.pdf)
- [Threat Modeling: A Summary of Available Methods](https://insights.sei.cmu.edu/library/threat-modeling-a-summary-of-available-methods/)
- [Threat Modeling Handbook](https://security.cms.gov/policy-guidance/threat-modeling-handbook)
- [Threat Modeling Process](https://owasp.org/www-community/Threat_Modeling_Process)
- [The Ultimate Beginner's Guide to Threat Modeling](https://shostack.org/resources/threat-modeling)
