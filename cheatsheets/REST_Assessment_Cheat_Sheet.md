# Шпаргалка по оценке REST

## О веб-сервисах RESTful

Веб-сервисы - это реализация веб-технологии, используемой для взаимодействия между машинами. Как таковые, они используются для взаимодействия между приложениями, Web 2.0 и Mashup, а также настольными и мобильными приложениями для вызова сервера.

Веб-сервисы RESTful (часто называемые просто REST) представляют собой упрощенный вариант веб-сервисов, основанный на шаблоне проектирования RESTful. На практике веб-сервисы RESTful используют HTTP-запросы, которые похожи на обычные HTTP-вызовы, в отличие от других технологий веб-сервисов, таких как SOAP, которые используют сложный протокол.

## Основные релевантные свойства веб-сервисов RESTful

- Использование HTTP-методов (`GET`, `POST`, `PUT` и `DELETE`) в качестве основного глагола для запрашиваемой операции.
- Спецификации нестандартных параметров:
    - Как часть URL-адреса.
    - В заголовках.
- Структурированные параметры и ответы с использованием JSON или XML в виде значений параметров, текста запроса или ответа. Они необходимы для передачи полезной информации для компьютера.
- Пользовательская аутентификация и управление сеансами, часто с использованием пользовательских токенов безопасности: это необходимо, поскольку взаимодействие между машинами не позволяет использовать последовательности входа в систему.
- Отсутствие официальной документации. [Предлагаемый стандарт для описания веб-сервисов RESTful под названием WADL](http://www.w3.org/Submission/wadl/) был представлен Sun Microsystems, но так и не был официально адаптирован.

## Сложности тестирования безопасности RESTful веб-сервисов

- Проверка приложения не выявила "поверхности атаки", то есть URL-адресов и структуры параметров, используемых веб-службой RESTful. Причины в следующем:
    - Ни одно приложение не использует все доступные функции и параметры, предоставляемые службой
    - Используемые ссылки часто активируются динамически с помощью клиентского кода, а не в виде ссылок на страницах.
    - Клиентское приложение часто не является веб-приложением и не позволяет проверить активирующую ссылку или даже соответствующий код.
- Параметры нестандартны, что затрудняет определение того, что является просто частью URL-адреса или постоянным заголовком, а что является параметром, который стоит [фаззить](https://owasp.org/www-community/Fuzzing).
- В качестве машинного интерфейса количество используемых параметров может быть очень большим, например, структура JSON может включать десятки параметров. [фаззинг](https://owasp.org/www-community/Fuzzing) каждого из них значительно увеличивает время, необходимое для тестирования.
- Пользовательские механизмы аутентификации требуют обратного проектирования и делают популярные инструменты бесполезными, поскольку они не могут отслеживать сеанс входа в систему.

## Как протестировать веб-сервис RESTful

Определите область атаки с помощью документации. Возможно, было бы лучше провести тестирование с помощью RESTful pen, если бы был разрешен некоторый уровень открытого тестирования, и вы могли бы получить информацию о сервисе.

Эта информация обеспечит более полный охват области атаки. Такую информацию следует искать:

- Формальное описание сервиса - В то время как для других типов веб-сервисов, таких как SOAP, часто доступно формальное описание, обычно в WSDL, для REST это редко встречается. Тем не менее, либо WSDL 2.0, либо WADL могут описывать REST и иногда используются.
- Руководство разработчика по использованию сервиса может быть менее подробным, но его обычно можно найти, и оно может даже рассматриваться как "непрозрачное" тестирование.
- Исходный код приложения или конфигурация - во многих платформах, включая dotNet, определение сервиса REST может быть легко получено из файлов конфигурации, а не из кода.

Сбор полных запросов с помощью [прокси-сервера](https://www.zaproxy.org/) - хотя это всегда важный этап тестирования, он более важен для приложений на базе REST, поскольку пользовательский интерфейс приложения может не указывать на фактическую поверхность атаки.

Обратите внимание, что прокси-сервер должен быть способен собирать полные запросы, а не только URL-адреса, поскольку службы REST используют нечто большее, чем просто получение параметров.

Проанализируйте собранные запросы, чтобы определить область атаки:

- Ищите нестандартные параметры:
    - Ищите ненормальные HTTP-заголовки - во многих случаях это могут быть параметры, основанные на заголовке.
    - Определите, имеет ли сегмент URL повторяющийся шаблон для всех URL-адресов. Такие шаблоны могут включать дату, число или строку, подобную идентификатору, и указывать на то, что сегмент URL является встроенным параметром URL.
        - Например: `http://server/srv/2013-10-21/use.php`
    - Ищите структурированные значения параметров - это могут быть JSON, XML или нестандартная структура.
    - Если последний элемент URL-адреса не имеет расширения, это может быть параметр. Это особенно актуально, если в технологии приложения обычно используются расширения или если предыдущий сегмент имеет расширение.
        - Например: `http://server/svc/Grid.asmx/GetRelatedListItems`
    - Ищите сильно различающиеся сегменты URL-адресов - один сегмент URL, который имеет много значений, может быть параметром, а не физическим каталогом.
        - Например, если URL-адрес `http://server/src/XXXX/page` повторяется с сотнями значений для `XXXX`, вероятность того, что `XXXX` является параметром.

Проверка нестандартных параметров: в некоторых случаях (но не во всех) установка значения сегмента URL, который предположительно может быть параметром, на значение, которое, как ожидается, будет недопустимым, может помочь определить, является ли это элементом пути к параметру. Если указан элемент path, веб-сервер вернет сообщение *404*, в то время как для недопустимого значения параметра ответом будет сообщение прикладного уровня, поскольку значение является допустимым на уровне веб-сервера.

Анализ собранных запросов для оптимизации [фаззинга](https://owasp.org/www-community/Fuzzing) - после определения потенциальных параметров для фаззинга проанализируйте собранные значения для каждого из них, чтобы определить:

- Допустимые и недопустимые значения, так что [fuzzing](https://owasp.org/www-community/Fuzzing) может фокусироваться на минимально допустимых значениях.
    - Например, отправка *0* для значения, которое всегда является положительным целым числом.
- Последовательности, позволяющие выполнять фаззинг за пределами диапазона, предположительно выделенного текущему пользователю.

Наконец, при [размывании] (https://owasp.org/www-community/Fuzzing) не забудьте эмулировать используемый механизм аутентификации.

## Похожие ресурсы

- [Шпаргалка по безопасности REST](REST_Security_Cheat_Sheet.md) - обратная сторона этой шпаргалки
- [YouTube: сервисы RESTful, слепая зона веб-безопасности](https://www.youtube.com/watch?v=pWq4qGLAZHI) - видеопрезентация, раскрывающая большинство тем, описанных в этой шпаргалке.
