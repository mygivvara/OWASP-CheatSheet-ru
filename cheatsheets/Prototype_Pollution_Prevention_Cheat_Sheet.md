# Шпаргалка по предотвращению загрязнения прототипов

## Объяснение

Загрязнение прототипа - это критическая уязвимость, которая может позволить злоумышленникам манипулировать объектами и свойствами JavaScript приложения, что приводит к серьезным проблемам безопасности, таким как несанкционированный доступ к данным, повышение привилегий и даже удаленное выполнение кода.

Примеры того, почему это опасно, смотрите по ссылкам в разделе [Другие ресурсы](#other-resources) ниже.

## Предлагаемые механизмы защиты

### Используйте `new Set()` или `new Map()`.

Разработчикам следует использовать `new Set()` или `new Map()` вместо использования объектных литералов:

```javascript
let allowedTags = new Set();
allowedTags.add('b');
if(allowedTags.has('b')){
  //...
}

let options = new Map();
options.set('spaces', 1);
let spaces = options.get('spaces')
```

### Если требуются объекты или объектные литералы

Если необходимо использовать объекты, то их следует создавать с помощью `Object.create(null)` API, чтобы гарантировать, что они не наследуются от прототипа объекта:

```javascript
let obj = Object.create(null);
```

Если требуются объектные литералы, то в качестве последнего средства вы можете использовать свойство `__proto__`:

```javascript
let obj = {__proto__:null};
```

### Используйте механизмы «freeze» и «seal» для объектов

Вы также можете использовать API-интерфейсы `Object.freeze()` и `Object.seal()`, чтобы предотвратить изменение встроенных прототипов, однако это может привести к сбою в работе приложения, если используемые библиотеки изменят встроенные прототипы.

### Флаг конфигурации Node.js

Node.js также имеется возможность полностью удалить свойство `__proto__`, используя флаг `--disable-proto=delete`. Обратите внимание, что это мера глубокой защиты.

Загрязнение прототипа все еще возможно при использовании свойств `constructor.prototype`, но удаление `__proto__` помогает уменьшить площадь атаки и предотвратить некоторые атаки.

### Другие ресурсы

- [Что такое загрязнение прототипа? (Академия веб-безопасности Portswigger)](https://portswigger.net/web-security/prototype-pollution)
- [Загрязнение прототипа (Snyk Learn)](https://learn.snyk.io/lessons/prototype-pollution/javascript/)

### Заслуги

Выражаем признательность [Gareth Hayes](https://garethheyes.co.uk/) за предоставление оригинальных рекомендаций по защите [в этом комментарии](https://github.com/OWASP/ASVS/issues/1563#issuecomment-1470027723).
