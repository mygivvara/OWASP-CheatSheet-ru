# Безопасность цепочки поставок программного обеспечения

## Вступление

Ни одно программное обеспечение не разрабатывается в вакууме; независимо от технологий, используемых для его разработки, программное обеспечение встраивается в цепочку поставок программного обеспечения (SSC). Согласно [NIST](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-204D.pdf), SSC организации можно определить как "набор шагов, которые создают, преобразуют и оценивают качество и соответствие политике программных артефактов". С точки зрения разработчика, эти этапы охватывают весь SDLC и выполняются с использованием широкого спектра компонентов и инструментов. Общие примеры (ни в коем случае не исчерпывающие) компонентов, которые особенно важны с точки зрения разработчика, включают:

- IDE и редакторы кода
- Исходный код собственной разработки
- Библиотеки программного обеспечения сторонних производителей
- Системы контроля версий (VCS)
- Инструменты сборки (Maven, Rake, make, Grunt и т.д.)
- Программное обеспечение CI/CD (Jenkins, CircleCI, TeamCity и др.)
- Инструменты управления конфигурацией (Ansible, Puppet, Chef и др.)
- Программное обеспечение и экосистемы для управления пакетами (pip, npm, Composer и др.)

Каждый из этих компонентов должен быть защищен; ошибка в одном компоненте, такая как уязвимая сторонняя зависимость или неправильно сконфигурированный VCS, может поставить под угрозу работу всего SSC. Таким образом, чтобы усилить безопасность цепочки поставок программного обеспечения (SCSS), разработчики должны обладать общим пониманием того, что такое SSC, общих угроз для нее, а также практик и методов, которые могут быть применены для снижения риска SSC.

## Обзор ландшафта угроз

Учитывая широту и сложность SSC, неудивительно, что спектр угроз для SSC столь же широк. К угрозам относятся [путаница в зависимостях](https://fossa.com/blog/dependency-confusion-understanding-preventing-attacks/), компрометация инфраструктуры вышестоящих поставщиков, кража сертификатов подписи кода и эксплойты в системах CI/CD. В более широком смысле угрозы можно разделить на четыре категории в зависимости от того, какой компонент цепочки поставок они стремятся скомпрометировать [[4,5](#ссылки)]:

- Угрозы исходному коду. Угрозы такого типа направлены на нарушение целостности исходного кода, который затем создается, развертывается или потенциально используется другими программными проектами. Угрозы этой категории включают эксплойты VCS, внедрение вредоносного или уязвимого кода в базу кода или создание кода из несанкционированной ветки.
- Угрозы среде сборки. Эти угрозы модифицируют программный артефакт, но без изменения исходного кода или использования самого процесса сборки. В качестве примеров можно привести заражение кэша сборки, взлом привилегированной учетной записи, используемой системой сборки, или публикацию программного обеспечения, созданного из ненадежного источника.
- Угрозы, связанные с зависимостями. Угрозы, возникающие в результате использования как прямых, так и переходных зависимостей программного обеспечения. Наиболее распространенной угрозой является использование уязвимой или скомпрометированной зависимости.
- Угрозы развертывания и среды выполнения. Эти угрозы используют либо процесс развертывания, либо среду выполнения. Распространенные примеры включают компрометацию учетной записи CI/CD с привилегиями, неправильную настройку программного обеспечения и развертывание скомпрометированных двоичных файлов.

Характеристики злоумышленников, стремящихся использовать SSC, также различны. Хотя компрометация SSC часто ассоциируется с очень изощренными действиями злоумышленников, такая изощренность по своей сути не является необходимой для атаки на SSC, особенно если атака направлена на компрометацию SSC организаций с плохими методами обеспечения безопасности. Мотивы злоумышленников также широко варьируются, и использование SSC-эксплойта может привести к потере конфиденциальности, целостности и/или доступности активов любой организации и, таким образом, к достижению широкого спектра целей злоумышленника, таких как шпионаж или финансовая выгода.

Наконец, следует признать, что многие угрозы SSC способны распространяться на множество объектов. Это связано с отношениями между потребителем и поставщиком, которые являются неотъемлемой частью SSC. Например, если будет скомпрометирован крупный поставщик программного обеспечения, будь то проприетарного или с открытым исходным кодом, это также может повлиять на многие последующие предприятия-потребители. Инциденты с Solarwind в 2020 году и Codecov в 2021 году являются отличными примерами этого в реальном мире.

## Меры по смягчению последствий и лучшие практики обеспечения безопасности

Снижение рисков, связанных с SSC, может показаться сложной задачей, но это не обязательно так. Даже при изощренных атаках, которые могут быть направлены на компрометацию вышестоящих поставщиков, отдельная организация может предпринять разумные шаги для защиты своих активов и снижения риска, даже если ее поставщик будет скомпрометирован. Хотя некоторые части SSC могут оставаться вне прямого контроля команд разработчиков, эти команды все равно должны внести свой вклад в улучшение SSC в своей организации; приведенное ниже руководство предназначено в качестве отправной точки для разработчиков, чтобы сделать именно это.

### Общие

Описанные ниже методы являются общими и могут быть использованы для снижения рисков, связанных с широким спектром типов угроз.

#### Внедрить строгий контроль доступа

  Скомпрометированные учетные записи, особенно привилегированные, представляют серьезную угрозу для SSC. Захват учетной записи может позволить злоумышленнику совершать различные вредоносные действия, включая внедрение кода в законные зависимости, манипулирование выполнением конвейера CI/CD и замену доброкачественного артефакта вредоносным. Таким образом, строгий контроль доступа к средам сборки, разработки, контроля версий и подобным средам имеет решающее значение. Лучшие практики включают соблюдение основных принципов безопасности, таких как минимизация привилегий и разделение обязанностей, обеспечение соблюдения MFA, ротация учетных данных и обеспечение того, чтобы учетные данные никогда не хранились и не передавались открытым текстом и не передавались в систему управления версиями.

#### Logging and Monitoring

  При рассмотрении SSC не следует упускать из виду важность оперативного контроля; эти средства контроля необходимы для обнаружения атак и обеспечения быстрого реагирования. В контексте SSC ведение журнала имеет решающее значение. Все системы, задействованные в SSC, включая VCS, средства сборки, механизмы доставки, хранилища артефактов и системы, ответственные за запуск приложений, должны быть настроены таким образом, чтобы регистрировать попытки аутентификации, изменения конфигурации и другие события, которые могут помочь в выявлении аномального поведения или которые могут оказаться решающими для реагирования на инциденты. Журналы по всему SSC должны быть достаточными как по глубине, так и по охвату, чтобы поддерживать обнаружение и реагирование

  Однако регистрации событий недостаточно. Эти журналы должны отслеживаться и, при необходимости, приниматься соответствующие меры. Предпочтительнее использовать централизованный SIEM, агрегатор журналов или аналогичный инструмент, особенно учитывая сложность SSC. Независимо от используемой технологии, основная цель остается неизменной: данные журнала должны быть доступны для использования.к системе управления версиями.

#### Используйте автоматизацию системы безопасности

Для сложных SSC критически важна автоматизация задач обеспечения безопасности, таких как сканирование, мониторинг и тестирование. Такая автоматизация, хотя и не заменяет ручные проверки и другие действия, выполняемые квалифицированными специалистами, способна обнаруживать уязвимости и потенциальные атаки, а в некоторых случаях и реагировать на них с таким масштабом и последовательностью, которых трудно достичь с помощью ручного вмешательства человека. К типам инструментов, поддерживающих автоматизацию, относятся SAST, DAST, SCA, сканеры изображений контейнеров и многое другое. Конкретные инструменты, которые в наибольшей степени способны принести пользу организации, могут существенно различаться в зависимости от характеристик организации. Однако, независимо от типа используемых инструментов и поставщиков, важно понимать, что сами эти инструменты должны быть интегрированы, защищены и правильно настроены. Невыполнение этого требования может на самом деле увеличить риск SSC для организации или, по крайней мере, не принести существенной пользы организации. Наконец, необходимо четко понимать, что эти инструменты являются лишь одним из компонентов общей программы SSC; они не могут рассматриваться как комплексное решение или на них нельзя полагаться при выявлении всех уязвимостей.

### Устранение угроз в исходном коде

Методы, описанные ниже, могут помочь снизить риск SSC, связанный с исходным кодом и разработкой.

#### Экспертные оценки

Ручные проверки кода являются важным и относительно недорогостоящим методом снижения риска SSC; эти проверки могут выступать как в качестве оперативного контроля, так и в качестве сдерживающего фактора. Проверки должны проводиться экспертами, обладающими опытом в области используемых технологий и процессов безопасного кодирования, и должны проводиться до объединения кода в системы управления версиями [[3] (#ссылки)]. В ходе проверок следует выявлять как непреднамеренные недостатки в системе безопасности, так и преднамеренный код, который может служить вредоносным целям. Результаты проверки должны быть задокументированы для последующего рассмотрения в случае необходимости.

#### Безопасная настройка систем контроля версий

Компрометация системы управления версиями или злоупотребление ею неизменно рассматривается как существенный риск для SSC [[4,5] (#ссылки)]. Общие рекомендации по обеспечению безопасности, такие как строгий контроль доступа, ведение журнала и мониторинг, являются двумя методами, помогающими защитить VCS. Также следует использовать функции безопасности, характерные для системы VCS, такие как защищенные ветви и политики слияния в git. Независимо от того, какие средства контроля безопасности добавлены в VCS, следует помнить, что секреты никогда не должны передаваться этим системам.

#### Безопасная платформа разработки

IDE, плагины для разработки и аналогичные инструменты могут помочь в процессе разработки. Однако, как и все компоненты программного обеспечения, эти компоненты могут иметь уязвимости и стать объектом атаки. Таким образом, важно предпринять шаги не только для обеспечения безопасного использования этих инструментов, но и для защиты базовой системы. В системе разработки должно быть установлено программное обеспечение endpoint security и для него должны быть выполнены оценки угроз [[2] (#ссылки)]. В процессе разработки следует использовать только надежное, хорошо проверенное программное обеспечение; это включает в себя не только "базовые" средства разработки, такие как IDE, но и любые плагины или расширения.  Кроме того, эти инструменты должны быть включены в системный инвентарь организации.

### Смягчение угроз зависимости

Ниже описаны лучшие практики и приемы, связанные с безопасным использованием зависимостей.

#### Оценка поставщиков

Прежде чем включать стороннюю услугу, продукт или программный компонент в SSC, необходимо тщательно оценить безопасность поставщика и конкретного предложения. Это относится как к предложениям с открытым исходным кодом, так и к проприетарным предложениям. Форма и объем анализа могут существенно различаться в зависимости от критичности и характера рассматриваемого компонента. Уровень готовности компонента, история безопасности и реакция поставщика на прошлые уязвимости являются полезной информацией практически в любом случае. Для более крупных поставщиков или предложений услуг необходимо определить, было ли решение оценено с помощью сторонних оценок и сертификаций, таких как те, которые были проведены с помощью [FedRAMP](https://marketplace.fedramp.gov/products ), [CSA](https://cloudsecurityalliance.org/star/registry) или различные стандарты ISO (ISO/IEC 27001, ISO/IEC 15408,
ISO/IEC 27034) могут быть полезными источниками данных, но на них нельзя полагаться исключительно.

Благодаря своей прозрачной природе проекты с открытым исходным кодом предоставляют дополнительные возможности для оценки. Вопросы для рассмотрения включают [[6](#ссылки)]:

- Ведется ли активная поддержка проекта?
- Достаточно ли популярен и известен ли проект в соответствующем сообществе?
- Является ли проект достаточно зрелым?
- Является ли оцениваемый продукт или версия "релизной" версией, например, не альфа-, бета-версией или аналогичными версиями?
- Учитывая сложность проекта, имеет ли проект достаточное количество сопровождающих и участников?
- Обновляет ли проект свои зависимости?
- Имеет ли проект достаточное покрытие тестами и включают ли тесты правила, относящиеся к безопасности?
- Хорошо ли документирован проект и содержит ли документ руководство по безопасному использованию компонента?
- Существует ли в проекте установленный и документированный процесс сообщения об уязвимостях и устраняются ли эти уязвимости своевременно?
- Соответствует ли предполагаемое использование проекта лицензии проекта?

#### Понимать и отслеживать зависимости программного обеспечения

Хотя зависимости от программного обеспечения сторонних производителей могут значительно ускорить процесс разработки, они также являются одним из основных рисков, связанных с современными приложениями. Зависимости должны быть не только тщательно отобраны до их включения в приложение, но и тщательно отслеживаться и поддерживаться на протяжении всего SDLC. Для достижения этой цели важным первым шагом является понимание различных зависимостей, используемых программным обеспечением. Для облегчения этого можно использовать SBOMs. Как производство, так и потребление этих SBOM должны быть автоматизированы, предпочтительно как часть процесса CI/CD в организации.

Как только организация проведет инвентаризацию зависимостей, она должна также отслеживать их на предмет известных уязвимостей. Это также должно быть максимально автоматизировано; такие инструменты, как [Проверка зависимостей OWASP](https://owasp.org/www-project-dependency-check/) или [retire.js](https://retirejs.github.io/retire.js/), могут помочь в этом процессе. Кроме того, такие источники, как [NVD](https://nvd.nist.gov/), [OSVDB](https://osv.dev/list) или [каталог CISA KEV](https://www.cisa.gov/known-exploited-vulnerabilities-catalog), также могут отслеживаться на предмет известных уязвимостей, связанных с зависимостями, используемыми в SSC организации.

#### SAST

Хотя использование SAST для обнаружения потенциальной защиты в специально разработанном коде является широко используемым методом обеспечения безопасности, его также можно использовать в компонентах OSS в рамках SSC [[2] (#ссылки)]. Как и при использовании SAST для кода, разработанного собственными силами, необходимо учитывать, что эти инструменты могут давать как ложные срабатывания, так и ложноотрицательные результаты. Таким образом, результаты SAST не должны приниматься без проверки вручную и не должны интерпретироваться как предоставляющие всестороннее представление о безопасности проекта. Однако, если понимать их ограничения, сканирование SAST может оказаться полезным при анализе как внутреннего кода, так и кода OSS.

#### Привязка файла блокировки/версии

Чтобы снизить вероятность непреднамеренного использования скомпрометированной или уязвимой версии в приложении, следует ограничить зависимости приложений конкретной версией, которая была предварительно проверена как легитимная и безопасная. Обычно это достигается с помощью файлов блокировки, таких как файл package-lock.json, используемый npm.

### Угрозы сборки

В разделе ниже описаны методы, которые особенно актуальны для защиты от угроз, связанных со сборкой.

#### Инструменты для создания инвентаря

Знание компонентов, используемых в SSC, имеет важное значение для обеспечения безопасности этого SSC. Эта концепция распространяется и на инструменты сборки. Перечень всех инструментов сборки, включая версии и любые плагины, должен быть автоматически собран и подключен к основной сети, необходимо также отслеживать базы данных уязвимостей, рекомендации поставщиков по безопасности и другие источники на предмет любых уязвимостей, связанных с выявленными инструментами сборки.

#### Упрочняющие инструменты для сборки

Скомпрометированные инструменты сборки могут использовать широкий спектр эксплойтов и, таким образом, представляют собой привлекательную цель для злоумышленников. Таким образом, вся инфраструктура и инструменты, используемые в процессе сборки, должны быть защищены для снижения риска. Методы защиты среды сборки включают [[2](#ссылки)]:

- Убедитесь, что средства сборки расположены в надлежащим образом изолированных сетях.
- Используйте DLP и другие инструменты и методы для обнаружения и предотвращения утечки.
- Отключите/удалите все неиспользуемые службы.
- Используйте системы контроля версий для управления конфигурациями конвейера и их хранения.

#### Принудительное подписание кода

С точки зрения потребителей программного обеспечения, прием только тех компонентов, которые были подписаны цифровой подписью, и проверка подписи перед использованием программного обеспечения является важным этапом для обеспечения подлинности компонента и того, что он не был подделан. Для тех, кто выполняет подписание кода, крайне важно, чтобы инфраструктура подписи кода была тщательно защищена. Невыполнение этого требования может привести к компрометации системы подписи кода и привести к дальнейшим атакам, в том числе нацеленным на пользователей программного обеспечения.

#### Используйте частное хранилище артефактов

Использование частного хранилища артефактов повышает степень контроля организации над различными артефактами, используемыми в рамках SSC. Артефакты должны быть проверены, прежде чем их можно будет разместить в частном хранилище, и организации должны убедиться, что использование этих хранилищ невозможно обойти. Хотя использование частных репозиториев может потребовать дополнительного обслуживания или снизить гибкость, они также могут быть важным компонентом SSC, особенно для чувствительных или критически важных приложений.

#### Используйте систему управления версиями для сценариев сборки и настройки

Преимущества VCSs могут быть реализованы для элементов, не связанных с управлением версиями; это особенно актуально для конфигурации и сценариев, связанных с конвейерами CI/CD. Принудительное управление версиями для этих файлов позволяет включать проверки, правила объединения и аналогичные элементы управления в процесс обновления конфигурации. Использование VCS также повышает видимость, позволяя легко отслеживать любые вносимые изменения, как вредоносные, так и доброкачественные [[2] (#ссылки)].

#### Проверка происхождения/Обеспечение создания достаточного количества метаданных

Важной частью SSC является гарантия того, что компонент SSC поступает из надежного источника и не был подделан. Важной частью этого является получение и использование информации о происхождении, определенной в [SLSA 1.0](https://slsa.dev/spec/v1.0/provenance) как "поддающаяся проверке информация о программных артефактах, описывающая, где, когда и как что-либо было произведено". Исходный код должен быть сгенерирован платформой сборки (в отличие от локальной системы разработки), злоумышленникам его будет очень сложно подделать, и он должен содержать все детали, необходимые для точной привязки результата к компоновщику [[7] (#ссылки)]. Исходные данные, соответствующие SLSA 1.0, могут быть сгенерированы с помощью таких сборщиков, как [FRSCA](https://github.com/buildsec/frsca) или [Github Actions](https://github.com/slsa-framework/slsa-github-generator), и проверены [с помощью SLSA Verifier](https://github.com/slsa-framework/slsa-verifier?tab=readme-ov-file)

#### Временные изолированные сборки

Повторное использование и совместное использование сред сборки может позволить злоумышленникам выполнять очистку кэша или иным образом легче внедрять вредоносный код.  Сборки должны выполняться в изолированных, временных ("эфемерных") средах. Этого можно достичь, используя такие технологии, как виртуальные машины или контейнеры для сборок, и гарантируя, что после этого среда будет немедленно уничтожена.

#### Ограничить использование параметров

Хотя передача контролируемых пользователем параметров в процесс сборки может повысить гибкость, это также увеличивает риск. Если пользователи могут изменять параметры, чтобы изменить способ выполнения сборки, злоумышленник с достаточными разрешениями также сможет изменить параметры и потенциально скомпрометировать процесс сборки [[8] (#ссылки)]. Таким образом, следует приложить усилия к тому, чтобы свести к минимуму или исключить любые контролируемые пользователем параметры сборки.

### Угрозы при развертывании и во время выполнения

В приведенном ниже разделе описаны несколько методов, которые можно использовать для защиты программного обеспечения на этапах развертывания и во время выполнения.

#### Проверьте двоичный файл окончательной сборки

После завершения процесса сборки не следует просто предполагать, что конечный результат безопасен. Анализ бинарной структуры может помочь обнаружить открытые секреты, неавторизованные компоненты или контент и проверить целостность [[2] (#ссылки)]. Эту задачу должны выполнять как поставщики, так и потребители.

#### Отслеживайте уязвимости в развернутом программном обеспечении

SSCS не заканчивается развертыванием программного обеспечения; для снижения риска необходимо отслеживать и поддерживать в рабочем состоянии развернутое программное обеспечение. Новые уязвимости, появляющиеся в результате обновления или просто недавно обнаруженные (или обнародованные), являются постоянной проблемой в программных системах [[4] (#ссылки)]. При выполнении этого мониторинга необходимо использовать целостный подход; зависимости кода, образы контейнеров, веб-серверы и компоненты операционной системы - это лишь некоторые из элементов, которые необходимо учитывать.Для поддержки этого мониторинга критически важна точная и актуальная инвентаризация системных компонентов. Кроме того, необходимо отслеживать небезопасные изменения конфигурации и принимать соответствующие меры.

## Ссылки на литературу

1. [NIST SP 800-204D: Strategies for the Integration of Software Supply Chain Security in DevSecOps CI/CD Pipelines](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-204D.pdf)
2. [Securing the Software Supply Chain: Recommended Practices Guide for Developers](https://media.defense.gov/2022/Sep/01/2003068942/-1/-1/0/ESF_SECURING_THE_SOFTWARE_SUPPLY_CHAIN_DEVELOPERS.PDF)
3. [Google Cloud Software Supply Chain Security: Safeguard Source](https://cloud.google.com/software-supply-chain-security/docs/safeguard-source)
4. [Google Cloud Software Supply Chain Security: Attack Vectors](https://cloud.google.com/software-supply-chain-security/docs/attack-vectors)
5. [SLSA 1.0: Threats](https://slsa.dev/spec/v1.0/threats)
6. [OpenSSF: Concise Guide for Evaluating Open Source Software](https://best.openssf.org/Concise-Guide-for-Evaluating-Open-Source-Software)
7. [SLSA 1.0: Requirements](https://slsa.dev/spec/v1.0/requirements#provenance-generation)
8. [Google Cloud Security Supply Chain Security: Safeguard Builds](https://cloud.google.com/software-supply-chain-security/docs/safeguard-builds)
